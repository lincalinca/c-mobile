# AI API Token Consumption Analysis\n\n## Overview\n\nEstimate of token consumption changes for receipt parsing with new prompt rules and schemas.\n\n---\n\n## Current State (Baseline)\n\n### System Prompt\n- Current CRITICAL RULES (7 rules): ~450 tokens\n- Base system prompt: ~800 tokens\n- **Subtotal: ~1,250 tokens**\n\n### JSON Schemas\n- receiptItemSchema (current): ~300 tokens\n- receiptDataSchema (current): ~200 tokens\n- lessonDetailsSchema (current): ~150 tokens\n- **Subtotal: ~650 tokens**\n\n### Per Receipt (Input)\n- Receipt image (vision): ~500-1,000 tokens (varies by image complexity)\n- Merchant details: ~100 tokens\n- **Subtotal: ~600-1,100 tokens**\n\n### Per Receipt (Output)\n- Current JSON response: ~200-400 tokens (varies by item count)\n- **Subtotal: ~200-400 tokens**\n\n**BASELINE TOTAL PER RECEIPT: ~2,700-3,400 tokens**\n\n---\n\n## New State (With All Phases)\n\n### System Prompt\n- New CRITICAL RULES (11 rules, including Phase 3): ~950 tokens (+500)\n- Base system prompt: ~800 tokens (unchanged)\n- **Subtotal: ~1,750 tokens (+500)**\n\n### JSON Schemas\n- receiptItemSchema (with gearDetails + warrantyDetails): ~600 tokens (+300)\n- receiptDataSchema (with summary): ~250 tokens (+50)\n- lessonDetailsSchema (with teacherName): ~180 tokens (+30)\n- **Subtotal: ~1,030 tokens (+380)**\n\n### Per Receipt (Input) - Phase 3 Only\n- Receipt image (vision): ~500-1,000 tokens (unchanged)\n- Merchant details: ~100 tokens (unchanged)\n- **Existing merchants list** (NEW): ~50-200 tokens (depends on user history)\n  - Estimate: 10-50 merchants × 4-5 tokens each\n- **Subtotal: ~650-1,300 tokens (+50-200)**\n\n### Per Receipt (Output)\n- New JSON response: ~400-700 tokens (+200-300)\n  - Gear details: +100-150 tokens\n  - Summary: +20-30 tokens\n  - Warranty details: +50-100 tokens\n  - Teacher name: +10-20 tokens\n- **Subtotal: ~400-700 tokens (+200-300)**\n\n**NEW TOTAL PER RECEIPT: ~3,830-5,280 tokens**\n\n---\n\n## Cost Impact Summary\n\n### Token Increase\n- **Prompt overhead**: +500 tokens (one-time per API call)\n- **Schema overhead**: +380 tokens (one-time per API call)\n- **Per receipt input**: +50-200 tokens (Phase 3 only)\n- **Per receipt output**: +200-300 tokens\n- **Total increase: +1,130-1,380 tokens per receipt**\n\n### Percentage Increase\n- **Baseline**: ~3,050 tokens (average)\n- **New**: ~4,555 tokens (average)\n- **Increase**: ~49% more tokens per receipt\n\n---\n\n## Cost Estimation (USD)\n\n### Using Claude 3.5 Sonnet (as of Jan 2026)\n- Input: $3 per 1M tokens\n- Output: $15 per 1M tokens\n\n### Per Receipt Cost\n- **Baseline**: ~$0.0092 per receipt\n- **New (Phase 1+2)**: ~$0.0137 per receipt (+$0.0045)\n- **New (Phase 1+2+3)**: ~$0.0155 per receipt (+$0.0063)\n\n### Monthly Cost (100 receipts/month)\n- **Baseline**: ~$0.92\n- **New (Phase 1+2)**: ~$1.37 (+$0.45)\n- **New (Phase 1+2+3)**: ~$1.55 (+$0.63)\n\n### Annual Cost (1,200 receipts/year)\n- **Baseline**: ~$11.04\n- **New (Phase 1+2)**: ~$16.44 (+$5.40)\n- **New (Phase 1+2+3)**: ~$18.60 (+$7.56)\n\n---\n\n## Optimization Opportunities\n\n1. **Conditional extraction**: Only extract gearDetails if category='gear'\n2. **Merchant matching caching**: Cache merchant list to reduce per-request tokens\n3. **Batch processing**: Process multiple receipts in single API call\n4. **Temperature tuning**: Keep at 0.1 for consistency (already optimal)\n\n---\n\n## Notes\n\n- Token estimates based on typical receipt complexity\n- Vision tokens vary significantly by image quality/size\n- Phase 3 merchant list size depends on user history (10-50 merchants typical)\n- Actual costs may vary ±15% based on receipt content\n- Consider volume discounts if processing >10k receipts/month\n"
